
<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NVO FAN TEAM | Hub</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Syncopate:wght@700&family=Rajdhani:wght@600;700&display=swap" rel="stylesheet">
    <style>
        :root { --neon: #ff003c; --dark: #050505; --card: rgba(15, 15, 15, 0.9); }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Rajdhani', sans-serif; }
        
        body { 
            background: var(--dark); color: #fff; overflow-x: hidden;
            background-image: radial-gradient(circle at 50% 50%, #1a0006 0%, #050505 100%);
            padding-bottom: 100px;
        }

        /* Neon Header */
        header { 
            padding: 25px; text-align: center; border-bottom: 2px solid var(--neon);
            box-shadow: 0 0 25px rgba(255, 0, 60, 0.4); background: #000;
        }
        .logo { font-family: 'Syncopate', sans-serif; font-size: 1.4rem; color: var(--neon); letter-spacing: 4px; text-shadow: 0 0 10px var(--neon); }

        .container { max-width: 450px; margin: auto; padding: 20px; }

        /* Sayaç Kartı */
        .stat-card { 
            background: var(--card); border: 1px solid var(--neon); padding: 20px; 
            border-radius: 4px; text-align: center; margin-bottom: 25px;
            position: relative; box-shadow: inset 0 0 15px rgba(255, 0, 60, 0.1);
        }
        .stat-num { font-size: 4rem; font-weight: 700; color: var(--neon); text-shadow: 0 0 20px var(--neon); }

        /* Sayfa Yapısı */
        .page { display: none; animation: fadeIn 0.4s ease; }
        .page.active { display: block; }

        /* Form Elemanları */
        .input-box { margin-bottom: 15px; }
        label { display: block; color: var(--neon); font-size: 0.75rem; margin-bottom: 5px; font-weight: bold; letter-spacing: 1px; }
        input { 
            width: 100%; padding: 14px; background: #000; border: 1px solid #222; 
            color: #fff; border-left: 3px solid var(--neon); outline: none;
        }

        .btn-action { 
            width: 100%; padding: 16px; background: var(--neon); color: #000; 
            border: none; font-weight: 900; cursor: pointer; text-transform: uppercase;
            clip-path: polygon(0 0, 100% 0, 100% 75%, 90% 100%, 0 100%); margin-top: 10px;
        }

        /* Chat */
        #chatBox { height: 420px; overflow-y: auto; display: flex; flex-direction: column; gap: 12px; }
        .msg { display: flex; gap: 10px; background: rgba(255,255,255,0.02); padding: 10px; border-radius: 4px; border-right: 2px solid var(--neon); }
        .msg-info { flex: 1; }
        .msg-user { color: var(--neon); font-size: 0.7rem; font-weight: 800; }

        /* Alt Navigasyon */
        .bottom-nav { 
            position: fixed; bottom: 0; left: 0; right: 0; background: #000; 
            display: flex; justify-content: space-around; padding: 18px; border-top: 2px solid var(--neon);
        }
        .bottom-nav i { font-size: 1.4rem; color: #444; transition: 0.3s; }
        .bottom-nav i.active { color: var(--neon); text-shadow: 0 0 10px var(--neon); }

        @keyframes fadeIn { from { opacity: 0; transform: scale(0.98); } to { opacity: 1; transform: scale(1); } }
    </style>
</head>
<body>

    <header><div class="logo">NVO FAN TEAM</div></header>

    <div class="container">
        <div class="stat-card">
            <p style="font-size: 0.7rem; color: #666; font-weight: 900;">TEAM STATUS: ONLINE</p>
            <div id="countDisplay" class="stat-num">0</div>
        </div>

        <div id="homePage" class="page active">
            <div id="annFeed"></div>
        </div>

        <div id="chatPage" class="page">
            <div class="stat-card" style="text-align:left;">
                <div id="chatBox"></div>
                <div id="chatControls" style="display:none; margin-top:15px;">
                    <input type="text" id="msgInput" placeholder="Sisteme mesaj bırak...">
                    <button onclick="sendMsg()" class="btn-action" style="padding:10px;">GÖNDER</button>
                </div>
            </div>
        </div>

        <div id="profilePage" class="page">
            <div class="stat-card">
                <img id="profilePreview" src="https://via.placeholder.com/100" style="width:100px; height:100px; border-radius:50%; border:2px solid var(--neon); margin-bottom:15px; object-fit: cover;">
                <h3 id="displayUserName">Kullanıcı</h3>

                <div class="input-box" style="text-align:left; margin-top:20px;">
                    <label>FOTOĞRAF KODU (HIZLI RESİM'DEN ALDIĞINI YAPIŞTIR)</label>
                    <input type="text" id="picUrlInput" placeholder="<a href=... ile başlayan kod">
                </div>
                
                <div class="input-box" style="text-align:left;">
                    <label>NICKNAME</label>
                    <input type="text" id="nameInput" placeholder="İsminiz">
                </div>

                <button class="btn-action" onclick="saveUser()">PROFİLİ SİSTEME İŞLE</button>
                <button onclick="logout()" style="margin-top:20px; background:none; border:none; color:#444; cursor:pointer; font-weight:bold;">ÇIKIŞ YAP</button>
            </div>
        </div>

        <div id="loginGate" style="text-align: center;"><button class="btn-action" style="background:#fff; color:#000;" onclick="login()">GOOGLE İLE GİRİŞ</button></div>
    </div>

    <nav class="bottom-nav">
        <i class="fas fa-home active" onclick="nav('home', this)"></i>
        <i class="fas fa-comments" onclick="nav('chat', this)"></i>
        <i class="fas fa-user-circle" onclick="nav('profile', this)"></i>
    </nav>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
    import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";
    import { getFirestore, doc, setDoc, getDoc, updateDoc, onSnapshot, collection, addDoc, query, orderBy, serverTimestamp, increment } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyAh1FMjRRyQsiRUf1YKf0htPDSP-I8j-J8",
        authDomain: "nvo-fan.firebaseapp.com",
        projectId: "nvo-fan",
        storageBucket: "nvo-fan.appspot.com",
        messagingSenderId: "724570776040",
        appId: "1:724570776040:web:fdae1a49175a6bd44ac45d"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const provider = new GoogleAuthProvider();

    // AKILLI AYIKLAYICI: Karmaşık kodun içinden resmi bulur
    function getCleanLink(input) {
        if (input.includes('<img')) {
            const match = input.match(/src="([^"]+)"/);
            return match ? match[1] : input;
        }
        return input;
    }

    window.nav = (page, el) => {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(page + 'Page').classList.add('active');
        document.querySelectorAll('.bottom-nav i').forEach(i => i.classList.remove('active'));
        el.classList.add('active');
    };

    onAuthStateChanged(auth, async (user) => {
        if(user) {
            document.getElementById('loginGate').style.display = 'none';
            document.getElementById('chatControls').style.display = 'block';
            const userRef = doc(db, "users", user.uid);
            const snap = await getDoc(userRef);
            if(!snap.exists()) {
                await setDoc(userRef, { name: user.displayName, photo: user.photoURL });
                await updateDoc(doc(db, "stats", "members"), { count: increment(1) });
            } else {
                const data = snap.data();
                document.getElementById('profilePreview').src = data.photo || user.photoURL;
                document.getElementById('displayUserName').innerText = data.name;
                document.getElementById('nameInput').value = data.name;
                document.getElementById('picUrlInput').value = data.photo;
            }
        }
    });

    window.login = () => signInWithPopup(auth, provider);
    window.logout = () => signOut(auth).then(() => location.reload());

    window.saveUser = async () => {
        const newName = document.getElementById('nameInput').value;
        const rawLink = document.getElementById('picUrlInput').value;
        const finalPhoto = getCleanLink(rawLink);

        if(newName.trim()) {
            await updateDoc(doc(db, "users", auth.currentUser.uid), { name: newName, photo: finalPhoto });
            alert("PROFİL SİSTEME AKTARILDI!");
            location.reload();
        }
    };

    onSnapshot(doc(db, "stats", "members"), d => { if(d.exists()) document.getElementById('countDisplay').innerText = d.data().count; });

    onSnapshot(query(collection(db, "messages"), orderBy("time", "asc")), snap => {
        const box = document.getElementById('chatBox'); box.innerHTML = "";
        snap.forEach(d => {
            const m = d.data();
            box.innerHTML += `<div class="msg"><img src="${m.photo}" style="width:35px;height:35px;border-radius:3px;border:1px solid var(--neon)"><div class="msg-info"><span class="msg-user">${m.name}</span><p style="font-size:0.9rem;">${m.text}</p></div></div>`;
        });
        box.scrollTop = box.scrollHeight;
    });

    window.sendMsg = async () => {
        const txt = document.getElementById('msgInput').value;
        const u = await getDoc(doc(db, "users", auth.currentUser.uid));
        if(txt.trim()) {
            await addDoc(collection(db, "messages"), { name: u.data().name, photo: u.data().photo, text: txt, time: serverTimestamp() });
            document.getElementById('msgInput').value = "";
        }
    };
</script>
</body>
</html>
