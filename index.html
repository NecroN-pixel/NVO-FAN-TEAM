<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NVO TEAM HUB</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --red: #ff3e3e; --bg: #080808; --glass: rgba(255, 255, 255, 0.03); --border: rgba(255, 255, 255, 0.1); }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Inter', sans-serif; transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        body { background: var(--bg); color: #e0e0e0; line-height: 1.6; overflow-x: hidden; padding-bottom: 80px; }

        /* Arkaplan IÅŸÄ±ltÄ±larÄ± */
        .glow { position: fixed; width: 300px; height: 300px; background: radial-gradient(circle, rgba(255,62,62,0.1) 0%, transparent 70%); z-index: -1; pointer-events: none; }

        /* Modern Navigasyon */
        .top-nav { background: rgba(0,0,0,0.8); backdrop-filter: blur(20px); padding: 15px; text-align: center; border-bottom: 1px solid var(--border); position: sticky; top: 0; z-index: 1000; }
        .logo { font-size: 1.4rem; font-weight: 900; color: var(--red); letter-spacing: 3px; text-transform: uppercase; }

        .container { max-width: 550px; margin: 20px auto; padding: 0 15px; }

        /* Cam Efekti Kartlar */
        .card { background: var(--glass); backdrop-filter: blur(10px); border: 1px solid var(--border); border-radius: 24px; padding: 25px; margin-bottom: 20px; box-shadow: 0 15px 35px rgba(0,0,0,0.5); }
        
        /* Ãœye SayacÄ± */
        .counter-card { background: linear-gradient(135deg, rgba(255,62,62,0.15) 0%, transparent 100%); border: 1px solid rgba(255,62,62,0.3); text-align: center; }
        .count-num { font-size: 3.5rem; font-weight: 900; color: var(--red); line-height: 1; text-shadow: 0 0 20px rgba(255,62,62,0.4); }

        /* Sekme Sistemi */
        .tab-bar { display: flex; gap: 8px; margin-bottom: 20px; background: #111; padding: 6px; border-radius: 16px; border: 1px solid var(--border); }
        .tab { flex: 1; padding: 12px; text-align: center; cursor: pointer; border-radius: 12px; font-weight: bold; font-size: 0.9rem; color: #666; }
        .tab.active { background: var(--red); color: white; box-shadow: 0 5px 15px rgba(255,62,62,0.3); }

        /* Profil ve Formlar */
        .profile-pic { width: 110px; height: 110px; border-radius: 50%; object-fit: cover; border: 3px solid var(--red); margin-bottom: 15px; box-shadow: 0 0 25px rgba(255,62,62,0.2); }
        input { width: 100%; padding: 14px; margin-top: 10px; border-radius: 14px; background: rgba(0,0,0,0.4); border: 1px solid var(--border); color: white; font-size: 1rem; }
        input:focus { border-color: var(--red); background: rgba(0,0,0,0.6); }

        /* Rehber Kutusu */
        .guide-box { background: rgba(30, 215, 96, 0.05); border: 1px dashed #1ed760; padding: 15px; border-radius: 16px; margin: 15px 0; font-size: 0.85rem; text-align: left; }
        
        .btn { width: 100%; padding: 16px; border-radius: 16px; border: none; font-weight: 800; cursor: pointer; margin-top: 12px; font-size: 1rem; }
        .btn-red { background: var(--red); color: white; }
        .btn-ghost { background: transparent; border: 1px solid var(--border); color: #888; margin-top: 20px; }

        /* Chat AkÄ±ÅŸÄ± */
        #chatBox { height: 450px; overflow-y: auto; display: flex; flex-direction: column; gap: 15px; padding-right: 5px; scroll-behavior: smooth; }
        .msg-row { display: flex; gap: 12px; align-items: flex-start; animation: slideIn 0.3s ease; }
        .msg-text { background: rgba(255,255,255,0.05); padding: 12px 16px; border-radius: 18px; border-bottom-left-radius: 4px; font-size: 0.95rem; flex: 1; }
        .msg-user { font-size: 0.75rem; color: var(--red); font-weight: 800; display: block; margin-bottom: 4px; }

        /* Alt Navigasyon */
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background: rgba(0,0,0,0.9); backdrop-filter: blur(20px); display: flex; justify-content: space-around; padding: 18px; border-top: 1px solid var(--border); }
        .bottom-nav i { font-size: 1.3rem; color: #444; }
        .bottom-nav i.active { color: var(--red); }

        @keyframes slideIn { from { opacity: 0; transform: translateX(-10px); } to { opacity: 1; transform: translateX(0); } }
        .page { display: none; } .page.active { display: block; animation: fadeIn 0.4s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>
    <div class="glow" style="top: -100px; left: -100px;"></div>
    <div class="glow" style="bottom: -100px; right: -100px; background: radial-gradient(circle, rgba(255,62,62,0.05) 0%, transparent 70%);"></div>

    <div class="top-nav"><div class="logo">NVO TEAM HUB</div></div>

    <div class="container">
        <div class="card counter-card">
            <p style="font-size: 0.75rem; font-weight: 800; color: var(--red); opacity: 0.8;">OFFICIAL TEAM MEMBERS</p>
            <div id="totalCount" class="count-num">0</div>
        </div>

        <div class="tab-bar">
            <div class="tab active" onclick="nav('home', this)">DUYURU</div>
            <div class="tab" onclick="nav('chat', this)">CHAT</div>
            <div class="tab" id="pTab" style="display:none" onclick="nav('profile', this)">PROFÄ°L</div>
        </div>

        <div id="homePage" class="page active">
            <div id="adminPanel" class="card" style="display:none; border-color: var(--red);">
                <textarea id="annInput" placeholder="Kurucu duyurusu yazÄ±n..." style="width:100%; height:80px; background:rgba(0,0,0,0.5); border-radius:12px; padding:10px; color:white; border:1px solid #333; outline:none;"></textarea>
                <button class="btn btn-red" onclick="sendAnn()">YAYINLA</button>
            </div>
            <div id="annList"></div>
        </div>

        <div id="chatPage" class="page">
            <div class="card">
                <div id="chatBox"></div>
                <div id="chatIn" style="display:none; margin-top:15px; border-top:1px solid var(--border); padding-top:15px;">
                    <div style="display:flex; gap:10px;">
                        <input type="text" id="msgInput" placeholder="Mesaj yaz..." style="margin:0;">
                        <button onclick="sendChat()" class="btn btn-red" style="width:auto; margin:0; padding:0 20px;"><i class="fas fa-paper-plane"></i></button>
                    </div>
                </div>
                <div id="chatWait" style="text-align:center; padding:20px; color:#555;">Sohbet etmek iÃ§in giriÅŸ yap.</div>
            </div>
        </div>

        <div id="profilePage" class="page">
            <div class="card" style="text-align: center;">
                <img id="myAvatar" class="profile-pic" src="https://via.placeholder.com/110">
                <h2 id="myName" style="margin-bottom: 15px;">KullanÄ±cÄ±</h2>

                <div class="guide-box">
                    <strong>ðŸ“¸ FotoÄŸrafÄ±nÄ± DeÄŸiÅŸtir:</strong><br>
                    1. <a href="https://hizliresim.com" target="_blank" style="color:#1ed760; font-weight:bold;">HÄ±zlÄ± Resim</a> sitesine yÃ¼kle.<br>
                    2. <b>"Direkt Link"</b> yazanÄ± kopyala.<br>
                    3. AÅŸaÄŸÄ±daki kutuya yapÄ±ÅŸtÄ±r ve kaydet.
                </div>

                <input type="text" id="picUrlIn" placeholder="FotoÄŸraf Linki (https://...)">
                <input type="text" id="nameIn" placeholder="GÃ¶rÃ¼nÃ¼r Ä°sim">
                <button class="btn btn-red" onclick="saveProfile()">PROFÄ°LÄ° GÃœNCELLE</button>

                <button class="btn btn-ghost" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Oturumu Kapat</button>
                <p onclick="delAcc()" style="color:#300; font-size:0.7rem; margin-top:20px; cursor:pointer;">HesabÄ± Tamamen Sil</p>
            </div>
        </div>

        <div id="loginArea" style="margin-top: 10px;">
            <button class="btn" style="background:white; color:black;" onclick="login()"><i class="fab fa-google"></i> Google ile AramÄ±za KatÄ±l</button>
        </div>
    </div>

    <nav class="bottom-nav">
        <i class="fas fa-home active" onclick="nav('home', this)"></i>
        <i class="fas fa-comments" onclick="nav('chat', this)"></i>
        <i class="fas fa-user-gear" onclick="nav('profile', this)"></i>
    </nav>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
    import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut, deleteUser } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";
    import { getFirestore, doc, setDoc, getDoc, updateDoc, onSnapshot, collection, addDoc, query, orderBy, serverTimestamp, increment, deleteDoc } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyAh1FMjRRyQsiRUf1YKf0htPDSP-I8j-J8",
        authDomain: "nvo-fan.firebaseapp.com",
        projectId: "nvo-fan",
        storageBucket: "nvo-fan.appspot.com",
        messagingSenderId: "724570776040",
        appId: "1:724570776040:web:fdae1a49175a6bd44ac45d"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const provider = new GoogleAuthProvider();

    // SAYFA GEÃ‡Ä°ÅžÄ°
    window.nav = (id, el) => {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(id + 'Page').classList.add('active');
        document.querySelectorAll('.tab, .bottom-nav i').forEach(t => t.classList.remove('active'));
        el.classList.add('active');
    };

    // OTURUM
    onAuthStateChanged(auth, async (user) => {
        if(user) {
            document.getElementById('loginArea').style.display = 'none';
            document.getElementById('pTab').style.display = 'block';
            document.getElementById('chatIn').style.display = 'block';
            document.getElementById('chatWait').style.display = 'none';
            
            const uRef = doc(db, "users", user.uid);
            const snap = await getDoc(uRef);
            if(!snap.exists()) {
                await setDoc(uRef, { name: user.displayName, photo: user.photoURL });
                await updateDoc(doc(db, "stats", "members"), { count: increment(1) });
            } else {
                const data = snap.data();
                document.getElementById('myAvatar').src = data.photo || user.photoURL;
                document.getElementById('myName').innerText = data.name;
                document.getElementById('nameIn').value = data.name;
                document.getElementById('picUrlIn').value = data.photo;
            }
            if(user.email === "necron.offical@gmail.com") document.getElementById('adminPanel').style.display = 'block';
        }
    });

    window.login = () => signInWithPopup(auth, provider);
    window.logout = () => confirm("Ã‡Ä±kÄ±ÅŸ yapÄ±lsÄ±n mÄ±?") && signOut(auth).then(() => location.reload());

    window.saveProfile = async () => {
        const u = auth.currentUser;
        const name = document.getElementById('nameIn').value;
        const pic = document.getElementById('picUrlIn').value;
        if(name.trim()) {
            await updateDoc(doc(db, "users", u.uid), { name: name, photo: pic });
            alert("Profil GÃ¼ncellendi!");
            location.reload();
        }
    };

    // SAYAÃ‡
    onSnapshot(doc(db, "stats", "members"), d => {
        if(d.exists()) document.getElementById('totalCount').innerText = d.data().count;
    });

    // DUYURU & CHAT (VERÄ° Ã‡EKME)
    onSnapshot(query(collection(db, "announcements"), orderBy("time", "desc")), snap => {
        const list = document.getElementById('annList');
        list.innerHTML = "";
        snap.forEach(d => {
            list.innerHTML += `<div class="card" style="border-left:4px solid var(--red)">
                <small style="color:var(--red); font-weight:900;">OFFICIAL ANNOUNCEMENT</small>
                <p style="margin-top:5px;">${d.data().text}</p>
            </div>`;
        });
    });

    onSnapshot(query(collection(db, "messages"), orderBy("time", "asc")), snap => {
        const box = document.getElementById('chatBox');
        box.innerHTML = "";
        snap.forEach(d => {
            const m = d.data();
            box.innerHTML += `<div class="msg-row">
                <img src="${m.photo || 'https://via.placeholder.com/35'}" style="width:35px;height:35px;border-radius:50%">
                <div class="msg-text"><span class="msg-user">${m.name}</span>${m.text}</div>
            </div>`;
        });
        box.scrollTop = box.scrollHeight;
    });

    window.sendChat = async () => {
        const val = document.getElementById('msgInput').value;
        if(!val.trim()) return;
        const uSnap = await getDoc(doc(db, "users", auth.currentUser.uid));
        await addDoc(collection(db, "messages"), { 
            name: uSnap.data().name, 
            photo: uSnap.data().photo, 
            text: val, 
            time: serverTimestamp() 
        });
        document.getElementById('msgInput').value = "";
    };

    window.sendAnn = async () => {
        const val = document.getElementById('annInput').value;
        if(val.trim()) {
            await addDoc(collection(db, "announcements"), { text: val, time: serverTimestamp() });
            document.getElementById('annInput').value = "";
        }
    };

    window.delAcc = async () => {
        if(confirm("TÃœM VERÄ°LERÄ°N SÄ°LÄ°NECEK! Emin misin?")) {
            await deleteDoc(doc(db, "users", auth.currentUser.uid));
            await updateDoc(doc(db, "stats", "members"), { count: increment(-1) });
            await deleteUser(auth.currentUser);
            location.reload();
        }
    };
</script>
</body>
</html>

