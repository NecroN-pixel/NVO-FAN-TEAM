<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NVO FAN TEAM | Sosyal</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --yt-red: #ff0000; --bg: #0a0a0a; --card: #161616; --text: #ffffff; }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); padding-bottom: 70px; }

        /* HEADER & TABS */
        header { padding: 20px; text-align: center; background: #000; border-bottom: 1px solid #222; }
        .tabs { display: flex; background: #111; border-bottom: 1px solid #333; position: sticky; top: 0; z-index: 100; }
        .tab { flex: 1; padding: 15px; text-align: center; cursor: pointer; color: #666; font-weight: bold; transition: 0.3s; }
        .tab.active { color: var(--yt-red); border-bottom: 3px solid var(--yt-red); background: #1a1a1a; }

        .container { max-width: 500px; margin: auto; padding: 15px; }

        /* SECTIONS */
        .section { display: none; min-height: 300px; }
        .section.active { display: block; }

        /* MESAJ VE DUYURU STİLLERİ */
        .card { background: var(--card); border-radius: 12px; padding: 15px; margin-bottom: 10px; border: 1px solid #222; word-wrap: break-word; }
        .ann-card { border-left: 5px solid var(--yt-red); background: #1a0a0a; }
        .user-name { font-size: 0.75rem; color: var(--yt-red); font-weight: bold; margin-bottom: 5px; display: block; }
        
        /* CHAT KUTUSU */
        #chatBox { height: 60vh; overflow-y: auto; display: flex; flex-direction: column-reverse; /* Yeni mesajlar altta kalsın */ }
        
        /* INPUT AREA */
        .input-bar { position: fixed; bottom: 65px; left: 0; right: 0; padding: 10px; background: #111; display: flex; gap: 8px; border-top: 1px solid #333; }
        input, textarea { flex: 1; padding: 12px; border-radius: 8px; border: 1px solid #333; background: #222; color: white; outline: none; }
        .send-btn { background: var(--yt-red); color: white; border: none; padding: 0 20px; border-radius: 8px; font-weight: bold; }

        /* ADMIN PANEL */
        #adminPanel { background: #1a1a1a; padding: 15px; border-radius: 12px; border: 1px dashed var(--yt-red); margin-bottom: 15px; }

        /* NAV */
        nav { position: fixed; bottom: 0; width: 100%; background: #000; display: flex; justify-content: space-around; padding: 15px; border-top: 1px solid #222; }
        nav a { color: #555; font-size: 1.2rem; }
        nav a.active { color: var(--yt-red); }
    </style>
</head>
<body>

<header><h1 style="color:var(--yt-red); font-size:1.5rem;">NVO FAN TEAM</h1></header>

<div class="tabs">
    <div class="tab active" onclick="switchTab('ann-sec', this)">DUYURULAR</div>
    <div class="tab" onclick="switchTab('chat-sec', this)">GLOBAL CHAT</div>
</div>

<div class="container">
    <div id="ann-sec" class="section active">
        <div id="adminPanel" style="display:none;">
            <textarea id="annInput" placeholder="Kurucu duyurusu yaz..."></textarea>
            <button class="send-btn" style="width:100%; margin-top:10px; height:40px;" onclick="postAnn()">YAYINLA</button>
        </div>
        <div id="annList"></div>
    </div>

    <div id="chat-sec" class="section">
        <div id="chatBox"></div>
        <div class="input-bar" id="chatInputBar" style="display:none;">
            <input type="text" id="chatInput" placeholder="Mesajınızı yazın...">
            <button class="send-btn" onclick="sendChat()">GÖNDER</button>
        </div>
        <div id="loginWarn" style="text-align:center; padding:20px; color:#666;">Yazmak için giriş yapmalısın.</div>
    </div>
</div>

<div id="authFloat" style="position:fixed; bottom:120px; width:100%; display:flex; justify-content:center; padding:0 20px;">
    <button id="googleBtn" style="width:100%; max-width:400px; padding:15px; border-radius:10px; border:none; font-weight:bold; cursor:pointer;">
        <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="18" style="vertical-align:middle;"> Google ile Giriş Yap
    </button>
</div>

<nav>
    <a href="#" class="active"><i class="fas fa-home"></i></a>
    <a href="https://youtube.com/@necronvo"><i class="fab fa-youtube"></i></a>
    <a href="https://www.instagram.com/necron.vo"><i class="fab fa-instagram"></i></a>
</nav>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
    import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";
    import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, serverTimestamp, limit } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyAh1FMjRRyQsiRUf1YKf0htPDSP-I8j-J8",
        authDomain: "nvo-fan.firebaseapp.com",
        projectId: "nvo-fan",
        storageBucket: "nvo-fan.firebasestorage.app",
        messagingSenderId: "724570776040",
        appId: "1:724570776040:web:fdae1a49175a6bd44ac45d"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const provider = new GoogleAuthProvider();

    const ADMIN_MAIL = "necron.offical@gmail.com";

    // --- TAB SİSTEMİ FİX ---
    window.switchTab = (id, el) => {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        el.classList.add('active');
    };

    // --- AUTH FİX ---
    onAuthStateChanged(auth, (user) => {
        if(user) {
            document.getElementById('authFloat').style.display = 'none';
            document.getElementById('chatInputBar').style.display = 'flex';
            document.getElementById('loginWarn').style.display = 'none';
            if(user.email === ADMIN_MAIL) document.getElementById('adminPanel').style.display = 'block';
        }
    });
    document.getElementById('googleBtn').onclick = () => signInWithPopup(auth, provider);

    // --- DUYURU SİSTEMİ FİX ---
    window.postAnn = async () => {
        const val = document.getElementById('annInput').value;
        if(val.trim()) {
            await addDoc(collection(db, "announcements"), { 
                text: val, 
                createdAt: serverTimestamp() 
            });
            document.getElementById('annInput').value = "";
        }
    };

    onSnapshot(query(collection(db, "announcements"), orderBy("createdAt", "desc")), (snap) => {
        const list = document.getElementById('annList');
        list.innerHTML = "";
        snap.forEach(doc => {
            list.innerHTML += `<div class="card ann-card"><strong><i class="fas fa-crown"></i> NECRONVO</strong><br>${doc.data().text}</div>`;
        });
    });

    // --- CHAT SİSTEMİ FİX ---
    window.sendChat = async () => {
        const val = document.getElementById('chatInput').value;
        if(val.trim() && auth.currentUser) {
            await addDoc(collection(db, "messages"), {
                name: auth.currentUser.displayName,
                text: val,
                createdAt: serverTimestamp()
            });
            document.getElementById('chatInput').value = "";
        }
    };

    // Mesajları çek ve en sonuncuyu altta göster
    onSnapshot(query(collection(db, "messages"), orderBy("createdAt", "desc"), limit(40)), (snap) => {
        const box = document.getElementById('chatBox');
        box.innerHTML = "";
        snap.forEach(doc => {
            const data = doc.data();
            box.innerHTML += `<div class="card"><span class="user-name">${data.name}</span>${data.text}</div>`;
        });
    });
</script>

</body>
</html>

